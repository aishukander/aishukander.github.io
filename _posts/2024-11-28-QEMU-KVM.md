---
title: QEMU/KVM
date: 2024-11-28 12:25 +0800
categories: [教學]
tags: [Linux, 虛擬化, QEMU, KVM]
description: 用QEMU搭配KVM來使用虛擬機。
---

# 安裝
## 檢查虛擬化的狀態
```bash
egrep -c '(vmx|svm)' /proc/cpuinfo
```

返回的數值代表已開啟虛擬化的線程數。 <br>
如果未啟用虛擬化則需要進入BIOS/UEFI內開啟(Intel為vmx，AMD為svm)。 <br>

## 檢查KVM的狀態
```bash
lsmod | grep kvm
```

返回的值應該會像是下圖。 <br>

![Desktop View](/assets/img/2024-11-28-QEMU-KVM/KVM.png)

## 安裝QEMU、Virt Manager、相關依賴跟工具
```bash
sudo pacman -Syu
sudo pacman -S archlinux-keyring qemu-full virt-manager virt-viewer edk2-ovmf dnsmasq vde2 bridge-utils openbsd-netcat libguestfs virglrenderer
```

## 啟動Libvirtd和NAT網路
```bash
sudo systemctl enable --now libvirtd
sudo virsh net-start default
sudo virsh net-autostart default
```

如果開啟時出現 'libvirt' zone that should have been installed with libvirt 可以先重啟firewalld跟libvirtd再試試看。 <br>
```bash
sudo systemctl start firewalld
sudo systemctl restart libvirtd
```

## 如果宿主機沒TPM 2.0但虛擬機需要
安裝個swtpm就好。 <br>
```bash
sudo pacman -S swtpm
```
